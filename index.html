<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Thumbnail Generator Pro</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-tertiary: #ffffff;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-tertiary: #6b7280;
            --border-color: #d1d5db;
            --border-focus: #3b82f6;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --accent-primary: #3b82f6;
            --accent-hover: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --transition-fast: 150ms;
            --transition-base: 250ms;
            --transition-slow: 350ms;
        }

        [data-theme="dark"] {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1b1b1b;
            --bg-tertiary: #242424;
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --border-color: #374151;
            --border-focus: #60a5fa;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.4);
            --accent-primary: #60a5fa;
            --accent-hover: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 20px;
            line-height: 1.6;
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: scale(1.05);
        }

        .theme-toggle:hover svg {
            fill: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: start;
        }

        .controls-panel {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            position: sticky;
            top: 20px;
        }

        .control-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
        }

        .tab-button {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all var(--transition-fast);
        }

        .tab-button:hover {
            background: var(--bg-secondary);
        }

        .tab-button.active {
            background: var(--accent-primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn var(--transition-base);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            transition: all var(--transition-fast);
            text-align: center;
        }

        .preset-btn:hover {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .preset-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .color-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .color-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-preview {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .color-preview:hover {
            transform: scale(1.1);
        }

        input[type="color"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-wrapper {
            position: relative;
            display: inline-block;
        }

        input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        input[type="checkbox"]:checked + .checkbox-custom {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        input[type="checkbox"]:checked + .checkbox-custom svg {
            display: block;
        }

        .checkbox-custom svg {
            display: none;
            width: 12px;
            height: 12px;
            fill: white;
        }

        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .file-upload:hover {
            border-color: var(--accent-primary);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload.drag-over {
            border-color: var(--accent-primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .file-upload.has-file {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            fill: var(--text-tertiary);
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .button {
            width: 100%;
            padding: 12px 20px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .button:active {
            transform: translateY(0);
        }

        .button svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .preview-section {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .preview-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .preview-size {
            background: var(--bg-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .zoom-controls {
            display: flex;
            gap: 8px;
        }

        .zoom-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .zoom-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .zoom-btn:hover svg {
            fill: white;
        }

        .zoom-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--text-secondary);
        }

        .canvas-container {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            position: relative;
            overflow: auto;
        }

        #canvas {
            max-width: 100%;
            height: auto;
            box-shadow: var(--shadow-lg);
            border-radius: 4px;
            transition: transform var(--transition-base);
        }

        .canvas-container.zoom-in #canvas {
            transform: scale(1.2);
        }

        .canvas-container.zoom-out #canvas {
            transform: scale(0.8);
        }

        .range-slider {
            width: 100%;
            margin-top: 10px;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .template-card {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .template-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-preview {
            width: 100%;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .template-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .gradient-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .gradient-preset {
            width: 100%;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            transition: transform var(--transition-fast);
            border: 2px solid transparent;
        }

        .gradient-preset:hover {
            transform: scale(1.1);
            border-color: var(--accent-primary);
        }

        .gradient-preset.active {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .success-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn var(--transition-base);
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-fast);
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .controls-panel {
                position: static;
                max-height: none;
            }
        }

        @media (max-width: 640px) {
            .preset-grid,
            .template-grid {
                grid-template-columns: 1fr;
            }

            .color-inputs {
                grid-template-columns: 1fr;
            }

            .button-group {
                grid-template-columns: 1fr;
            }
        }

        .shortcuts-help {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .shortcuts-help:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .shortcuts-help:hover svg {
            fill: white;
        }

        .shortcuts-help svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .shortcuts-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .shortcuts-modal.active {
            display: flex;
        }

        .shortcuts-content {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shortcuts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shortcuts-list {
            display: grid;
            gap: 12px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .shortcut-key {
            background: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <svg class="logo-icon" viewBox="0 0 100 100" fill="currentColor">
                    <rect x="10" y="10" width="35" height="35" rx="5"/>
                    <rect x="55" y="10" width="35" height="35" rx="5"/>
                    <rect x="10" y="55" width="35" height="35" rx="5"/>
                    <rect x="55" y="55" width="35" height="35" rx="5"/>
                </svg>
                SaaS Thumbnail Generator Pro
            </h1>
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()" data-tooltip="Toggle Dark Mode">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path id="theme-icon" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="main-grid">
            <div class="controls-panel">
                <div class="control-tabs">
                    <button class="tab-button active" onclick="switchTab('design')">Design</button>
                    <button class="tab-button" onclick="switchTab('templates')">Templates</button>
                    <button class="tab-button" onclick="switchTab('export')">Export</button>
                </div>

                <div id="design-tab" class="tab-content active">
                    <div class="control-group">
                        <label>Platform Presets</label>
                        <div class="preset-grid">
                            <button class="preset-btn" onclick="setPreset('youtube')">YouTube</button>
                            <button class="preset-btn" onclick="setPreset('chrome-small')">Chrome Small</button>
                            <button class="preset-btn" onclick="setPreset('chrome-large')">Chrome Large</button>
                            <button class="preset-btn" onclick="setPreset('chrome-promo')">Chrome Promo</button>
                            <button class="preset-btn" onclick="setPreset('product-hunt')">Product Hunt</button>
                            <button class="preset-btn" onclick="setPreset('twitter')">Twitter Card</button>
                            <button class="preset-btn" onclick="setPreset('facebook')">Facebook</button>
                            <button class="preset-btn" onclick="setPreset('linkedin')">LinkedIn</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Custom Dimensions</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <input type="number" id="canvasWidth" value="1280" placeholder="Width">
                            </div>
                            <div>
                                <input type="number" id="canvasHeight" value="800" placeholder="Height">
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Heading</label>
                        <input type="text" id="heading" value="Your Amazing SaaS Product" placeholder="Enter heading">
                        <div class="checkbox-group" style="margin-top: 10px;">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="showHeading" checked>
                                <div class="checkbox-custom">
                                    <svg viewBox="0 0 12 12">
                                        <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                            </div>
                            <label for="showHeading" style="margin: 0;">Show Heading</label>
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="uppercaseHeading">
                                <div class="checkbox-custom">
                                    <svg viewBox="0 0 12 12">
                                        <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                            </div>
                            <label for="uppercaseHeading" style="margin: 0;">Uppercase</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Description</label>
                        <textarea id="description" placeholder="Enter description">The complete solution for modern teams. Streamline your workflow and boost productivity with our powerful features.</textarea>
                    </div>

                    <div class="control-group">
                        <label>Features</label>
                        <textarea id="features" placeholder="One feature per line">Real-time collaboration
Advanced analytics dashboard
Seamless integrations
Enterprise-grade security</textarea>
                        <div class="checkbox-group" style="margin-top: 10px;">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="showFeatures" checked>
                                <div class="checkbox-custom">
                                    <svg viewBox="0 0 12 12">
                                        <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                            </div>
                            <label for="showFeatures" style="margin: 0;">Show Features</label>
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="showChecks" checked>
                                <div class="checkbox-custom">
                                    <svg viewBox="0 0 12 12">
                                        <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                            </div>
                            <label for="showChecks" style="margin: 0;">Show Checkmarks</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Colors</label>
                        <div class="color-inputs">
                            <div>
                                <label style="font-size: 12px; margin-bottom: 4px;">Background</label>
                                <div class="color-input-group">
                                    <div class="color-preview" id="bgColorPreview" onclick="openColorPicker('bgColor')"></div>
                                    <input type="text" id="bgColor" value="#ffffff" placeholder="#ffffff">
                                    <input type="color" id="bgColorPicker">
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 12px; margin-bottom: 4px;">Text</label>
                                <div class="color-input-group">
                                    <div class="color-preview" id="textColorPreview" onclick="openColorPicker('textColor')"></div>
                                    <input type="text" id="textColor" value="#111827" placeholder="#111827">
                                    <input type="color" id="textColorPicker">
                                </div>
                            </div>
                        </div>
                        <div class="color-inputs" style="margin-top: 10px;">
                            <div>
                                <label style="font-size: 12px; margin-bottom: 4px;">Accent</label>
                                <div class="color-input-group">
                                    <div class="color-preview" id="accentColorPreview" onclick="openColorPicker('accentColor')"></div>
                                    <input type="text" id="accentColor" value="#3b82f6" placeholder="#3b82f6">
                                    <input type="color" id="accentColorPicker">
                                </div>
                            </div>
                        </div>
                        
                        <label style="margin-top: 15px; margin-bottom: 8px;">Background Style</label>
                        <div class="gradient-presets">
                            <div class="gradient-preset" style="background: #ffffff;" onclick="setBackgroundStyle('solid', '#ffffff')" title="White"></div>
                            <div class="gradient-preset" style="background: #f3f4f6;" onclick="setBackgroundStyle('solid', '#f3f4f6')" title="Light Gray"></div>
                            <div class="gradient-preset" style="background: #000000;" onclick="setBackgroundStyle('solid', '#000000')" title="Black"></div>
                            <div class="gradient-preset" style="background: #1e40af;" onclick="setBackgroundStyle('solid', '#1e40af')" title="Blue"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="setBackgroundStyle('gradient1')" title="Purple Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="setBackgroundStyle('gradient2')" title="Pink Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="setBackgroundStyle('gradient3')" title="Cyan Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" onclick="setBackgroundStyle('gradient4')" title="Green Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="setBackgroundStyle('gradient5')" title="Sunset Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);" onclick="setBackgroundStyle('gradient6')" title="Ocean Gradient"></div>
                            <div class="gradient-preset" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);" onclick="setBackgroundStyle('gradient7')" title="Pastel Gradient"></div>
                            <div class="gradient-preset" style="background: #ef4444;" onclick="setBackgroundStyle('solid', '#ef4444')" title="Red"></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Upload Image</label>
                        <div class="file-upload" id="fileUploadContainer">
                            <input type="file" id="imageUpload" accept="image/*">
                            <svg class="upload-icon" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" opacity="0" id="uploadCheckmark"/>
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" opacity="0" id="uploadSuccess"/>
                                <path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z" id="uploadDefault"/>
                            </svg>
                            <div class="upload-text" id="uploadLabel">Click to upload or drag & drop image</div>
                        </div>
                        <div id="imageControls" style="display: none; margin-top: 10px;">
                            <label for="imageBorderRadius" style="font-size: 12px;">Image Border Radius</label>
                            <input type="range" id="imageBorderRadius" min="0" max="50" value="8" class="range-slider">
                            <div class="range-values">
                                <span>0px</span>
                                <span id="borderRadiusValue">8px</span>
                                <span>50px</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="templates-tab" class="tab-content">
                    <div class="control-group">
                        <label>Quick Templates</label>
                        <div class="template-grid">
                            <div class="template-card" onclick="applyTemplate('modern')">
                                <div class="template-preview" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                                <div class="template-name">Modern Gradient</div>
                            </div>
                            <div class="template-card" onclick="applyTemplate('minimal')">
                                <div class="template-preview" style="background: #f8f9fa;"></div>
                                <div class="template-name">Minimal Clean</div>
                            </div>
                            <div class="template-card" onclick="applyTemplate('bold')">
                                <div class="template-preview" style="background: #000;"></div>
                                <div class="template-name">Bold Dark</div>
                            </div>
                            <div class="template-card" onclick="applyTemplate('vibrant')">
                                <div class="template-preview" style="background: linear-gradient(135deg, #f093fb, #f5576c);"></div>
                                <div class="template-name">Vibrant</div>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Saved Templates</label>
                        <div id="savedTemplates" style="margin-top: 10px;">
                            <p style="color: var(--text-tertiary); font-size: 14px;">No saved templates yet</p>
                        </div>
                        <button class="button" style="margin-top: 15px;" onclick="saveCurrentTemplate()">
                            <svg viewBox="0 0 20 20">
                                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM2 7a2 2 0 012-2h12a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V7z"/>
                            </svg>
                            Save Current as Template
                        </button>
                    </div>
                </div>

                <div id="export-tab" class="tab-content">
                    <div class="control-group">
                        <label>Export Format</label>
                        <select id="exportFormat">
                            <option value="png">PNG (Recommended)</option>
                            <option value="jpg">JPG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>

                    <div class="control-group" id="jpgQuality" style="display: none;">
                        <label>JPG Quality</label>
                        <input type="range" id="jpgQualitySlider" min="0.1" max="1" step="0.1" value="0.9" class="range-slider">
                        <div class="range-values">
                            <span>10%</span>
                            <span id="jpgQualityValue">90%</span>
                            <span>100%</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Export Scale</label>
                        <select id="exportScale">
                            <option value="1">1x (Original)</option>
                            <option value="2">2x (Retina)</option>
                            <option value="0.5">0.5x (Small)</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button class="button" onclick="downloadImage()">
                            <svg viewBox="0 0 20 20">
                                <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                            </svg>
                            Download
                        </button>
                        <button class="button" onclick="batchExport()">
                            <svg viewBox="0 0 20 20">
                                <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                            </svg>
                            Batch Export
                        </button>
                    </div>

                    <div class="control-group" style="margin-top: 20px;">
                        <label>Quick Actions</label>
                        <button class="button" onclick="copyToClipboard()" style="margin-top: 10px;">
                            <svg viewBox="0 0 20 20">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                            </svg>
                            Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>

            <div class="preview-section">
                <div class="preview-header">
                    <h2>Preview</h2>
                    <div class="preview-info">
                        <div class="preview-size" id="previewInfo">1280 × 800</div>
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="zoomOut()" data-tooltip="Zoom Out">
                                <svg viewBox="0 0 20 20">
                                    <path d="M5 9a1 1 0 100 2h8a1 1 0 100-2H5z"/>
                                    <path fill-rule="evenodd" d="M9 3a6 6 0 11-6 6 6 6 0 016-6zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"/>
                                </svg>
                            </button>
                            <button class="zoom-btn" onclick="resetZoom()" data-tooltip="Reset Zoom">
                                <svg viewBox="0 0 20 20">
                                    <path d="M9 3a6 6 0 11-6 6 6 6 0 016-6zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"/>
                                </svg>
                            </button>
                            <button class="zoom-btn" onclick="zoomIn()" data-tooltip="Zoom In">
                                <svg viewBox="0 0 20 20">
                                    <path d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"/>
                                    <path fill-rule="evenodd" d="M9 3a6 6 0 11-6 6 6 6 0 016-6zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="shortcuts-help" onclick="toggleShortcuts()" data-tooltip="Keyboard Shortcuts">
        <svg viewBox="0 0 20 20">
            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"/>
        </svg>
    </div>

    <div class="shortcuts-modal" id="shortcutsModal">
        <div class="shortcuts-content">
            <div class="shortcuts-header">
                <h3>Keyboard Shortcuts</h3>
                <button onclick="toggleShortcuts()" style="background: none; border: none; cursor: pointer;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="shortcuts-list">
                <div class="shortcut-item">
                    <span>Download Image</span>
                    <span class="shortcut-key">Ctrl/Cmd + D</span>
                </div>
                <div class="shortcut-item">
                    <span>Save Template</span>
                    <span class="shortcut-key">Ctrl/Cmd + S</span>
                </div>
                <div class="shortcut-item">
                    <span>Undo</span>
                    <span class="shortcut-key">Ctrl/Cmd + Z</span>
                </div>
                <div class="shortcut-item">
                    <span>Redo</span>
                    <span class="shortcut-key">Ctrl/Cmd + Shift + Z</span>
                </div>
                <div class="shortcut-item">
                    <span>Toggle Preview</span>
                    <span class="shortcut-key">Space</span>
                </div>
                <div class="shortcut-item">
                    <span>Reset to Defaults</span>
                    <span class="shortcut-key">Ctrl/Cmd + R</span>
                </div>
                <div class="shortcut-item">
                    <span>Copy to Clipboard</span>
                    <span class="shortcut-key">Ctrl/Cmd + C</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load Inter font with font-display: swap for better performance
        const fontLink = document.createElement('link');
        fontLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap';
        fontLink.rel = 'stylesheet';
        document.head.appendChild(fontLink);

        // Canvas and state management
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: false }); // Disable alpha for better performance
        let uploadedImage = null;
        let currentPreset = '';
        let renderTimeout = null;
        let offscreenCanvas = null;
        let offscreenCtx = null;
        let zoomLevel = 1;
        let backgroundStyle = 'solid';
        let currentGradient = null;
        
        // History management
        const history = [];
        const maxHistorySize = 20;
        let historyIndex = -1;

        // Initialize offscreen canvas for performance
        function initOffscreenCanvas() {
            offscreenCanvas = document.createElement('canvas');
            offscreenCtx = offscreenCanvas.getContext('2d', { alpha: false });
        }

        // Presets configuration
        const presets = {
            'youtube': { width: 1280, height: 720, name: 'YouTube Thumbnail' },
            'chrome-small': { width: 440, height: 280, name: 'Chrome Web Store - Small' },
            'chrome-large': { width: 920, height: 680, name: 'Chrome Web Store - Large' },
            'chrome-promo': { width: 1400, height: 560, name: 'Chrome Web Store - Promo' },
            'product-hunt': { width: 1270, height: 760, name: 'Product Hunt Gallery' },
            'twitter': { width: 1200, height: 630, name: 'Twitter Card' },
            'facebook': { width: 1200, height: 630, name: 'Facebook Share' },
            'linkedin': { width: 1200, height: 627, name: 'LinkedIn Post' },
            'custom': { width: 1280, height: 800, name: 'Custom Size' }
        };

        // Gradient presets
        const gradients = {
            gradient1: ['#667eea', '#764ba2'],
            gradient2: ['#f093fb', '#f5576c'],
            gradient3: ['#4facfe', '#00f2fe'],
            gradient4: ['#43e97b', '#38f9d7'],
            gradient5: ['#fa709a', '#fee140'],
            gradient6: ['#30cfd0', '#330867'],
            gradient7: ['#a8edea', '#fed6e3']
        };

        // Template configurations
        const templates = {
            modern: {
                bgColor: '#667eea',
                textColor: '#ffffff',
                accentColor: '#ffd93d',
                backgroundStyle: 'gradient1',
                uppercaseHeading: true,
                showHeading: true,
                showFeatures: true,
                showChecks: true
            },
            minimal: {
                bgColor: '#f8f9fa',
                textColor: '#212529',
                accentColor: '#0066cc',
                backgroundStyle: 'solid',
                uppercaseHeading: false,
                showHeading: true,
                showFeatures: true,
                showChecks: false
            },
            bold: {
                bgColor: '#000000',
                textColor: '#ffffff',
                accentColor: '#ffcc00',
                backgroundStyle: 'solid',
                uppercaseHeading: true,
                showHeading: true,
                showFeatures: true,
                showChecks: true
            },
            vibrant: {
                bgColor: '#f093fb',
                textColor: '#ffffff',
                accentColor: '#4facfe',
                backgroundStyle: 'gradient2',
                uppercaseHeading: false,
                showHeading: true,
                showFeatures: true,
                showChecks: true
            }
        };

        // Performance optimization: Debounce function
        function debounce(func, wait) {
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(renderTimeout);
                    func(...args);
                };
                clearTimeout(renderTimeout);
                renderTimeout = setTimeout(later, wait);
            };
        }

        // Optimized render function using requestAnimationFrame
        const debouncedRender = debounce(() => {
            requestAnimationFrame(drawCanvas);
        }, 100);

        // Save state to history
        function saveToHistory() {
            const state = {
                width: document.getElementById('canvasWidth').value,
                height: document.getElementById('canvasHeight').value,
                heading: document.getElementById('heading').value,
                description: document.getElementById('description').value,
                features: document.getElementById('features').value,
                bgColor: document.getElementById('bgColor').value,
                textColor: document.getElementById('textColor').value,
                accentColor: document.getElementById('accentColor').value,
                showHeading: document.getElementById('showHeading').checked,
                showFeatures: document.getElementById('showFeatures').checked,
                showChecks: document.getElementById('showChecks').checked,
                uppercaseHeading: document.getElementById('uppercaseHeading').checked,
                backgroundStyle: backgroundStyle,
                currentGradient: currentGradient
            };

            // Remove future history if we're not at the end
            if (historyIndex < history.length - 1) {
                history.splice(historyIndex + 1);
            }

            history.push(state);
            if (history.length > maxHistorySize) {
                history.shift();
            } else {
                historyIndex++;
            }
        }

        // Undo function
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                restoreState(history[historyIndex]);
            }
        }

        // Redo function
        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                restoreState(history[historyIndex]);
            }
        }

        // Restore state from history
        function restoreState(state) {
            document.getElementById('canvasWidth').value = state.width;
            document.getElementById('canvasHeight').value = state.height;
            document.getElementById('heading').value = state.heading;
            document.getElementById('description').value = state.description;
            document.getElementById('features').value = state.features;
            document.getElementById('bgColor').value = state.bgColor;
            document.getElementById('textColor').value = state.textColor;
            document.getElementById('accentColor').value = state.accentColor;
            document.getElementById('showHeading').checked = state.showHeading;
            document.getElementById('showFeatures').checked = state.showFeatures;
            document.getElementById('showChecks').checked = state.showChecks;
            document.getElementById('uppercaseHeading').checked = state.uppercaseHeading;
            backgroundStyle = state.backgroundStyle;
            currentGradient = state.currentGradient;
            updateColorPreviews();
            drawCanvas();
        }

        // Theme management
        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update theme icon
            const icon = document.getElementById('theme-icon');
            if (newTheme === 'dark') {
                icon.setAttribute('d', 'M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z');
            } else {
                icon.setAttribute('d', 'M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
                if (savedTheme === 'dark') {
                    const icon = document.getElementById('theme-icon');
                    icon.setAttribute('d', 'M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z');
                }
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.setAttribute('data-theme', 'dark');
                const icon = document.getElementById('theme-icon');
                icon.setAttribute('d', 'M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z');
            }
        }

        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // Preset selection
        function setPreset(preset) {
            currentPreset = preset;
            const size = presets[preset];
            document.getElementById('canvasWidth').value = size.width;
            document.getElementById('canvasHeight').value = size.height;
            
            // Update active preset button
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            saveToHistory();
            drawCanvas();
        }

        // Background style management
        function setBackgroundStyle(style, color) {
            backgroundStyle = style;
            if (style === 'solid') {
                // When switching to solid, update the background color input
                if (color) {
                    document.getElementById('bgColor').value = color;
                }
                currentGradient = null;
                updateColorPreviews();
            } else if (gradients[style]) {
                currentGradient = gradients[style];
                // Optionally set bgColor to first gradient color for consistency
                document.getElementById('bgColor').value = currentGradient[0];
                updateColorPreviews();
            }
            
            // Update active gradient preset
            document.querySelectorAll('.gradient-preset').forEach(preset => preset.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            saveToHistory();
            drawCanvas();
        }

        // Apply template
        function applyTemplate(templateName) {
            const template = templates[templateName];
            if (template) {
                // Update color inputs
                document.getElementById('bgColor').value = template.bgColor;
                document.getElementById('textColor').value = template.textColor;
                document.getElementById('accentColor').value = template.accentColor;
                
                // Update checkboxes
                document.getElementById('uppercaseHeading').checked = template.uppercaseHeading;
                document.getElementById('showHeading').checked = template.showHeading !== undefined ? template.showHeading : true;
                document.getElementById('showFeatures').checked = template.showFeatures !== undefined ? template.showFeatures : true;
                document.getElementById('showChecks').checked = template.showChecks !== undefined ? template.showChecks : true;
                
                // Handle background style
                if (template.backgroundStyle) {
                    backgroundStyle = template.backgroundStyle;
                    if (template.backgroundStyle === 'solid') {
                        currentGradient = null;
                        // Update gradient preset visuals - remove active from all
                        document.querySelectorAll('.gradient-preset').forEach(preset => preset.classList.remove('active'));
                        // Set first preset (solid white) as active
                        const solidPreset = document.querySelector('.gradient-preset');
                        if (solidPreset) solidPreset.classList.add('active');
                    } else if (gradients[template.backgroundStyle]) {
                        currentGradient = gradients[template.backgroundStyle];
                        // Update gradient preset visuals
                        document.querySelectorAll('.gradient-preset').forEach(preset => preset.classList.remove('active'));
                        // Find and activate the matching gradient preset
                        const presets = document.querySelectorAll('.gradient-preset');
                        const gradientKeys = Object.keys(gradients);
                        const index = gradientKeys.indexOf(template.backgroundStyle);
                        if (index >= 0 && presets[index + 1]) { // +1 because first is solid
                            presets[index + 1].classList.add('active');
                        }
                    }
                }
                
                updateColorPreviews();
                saveToHistory();
                drawCanvas();
                showToast('Template applied successfully!');
            }
        }

        // Color picker management
        function openColorPicker(colorType) {
            const picker = document.getElementById(`${colorType}Picker`);
            picker.value = document.getElementById(colorType).value;
            picker.click();
            
            picker.onchange = function() {
                document.getElementById(colorType).value = picker.value;
                updateColorPreviews();
                saveToHistory();
                drawCanvas();
            };
        }

        // Update color previews
        function updateColorPreviews() {
            document.getElementById('bgColorPreview').style.background = document.getElementById('bgColor').value;
            document.getElementById('textColorPreview').style.background = document.getElementById('textColor').value;
            document.getElementById('accentColorPreview').style.background = document.getElementById('accentColor').value;
        }

        // Zoom controls
        function zoomIn() {
            zoomLevel = Math.min(zoomLevel + 0.2, 2);
            updateZoom();
        }

        function zoomOut() {
            zoomLevel = Math.max(zoomLevel - 0.2, 0.5);
            updateZoom();
        }

        function resetZoom() {
            zoomLevel = 1;
            updateZoom();
        }

        function updateZoom() {
            canvas.style.transform = `scale(${zoomLevel})`;
        }

        // Main canvas drawing function with performance optimizations
        function drawCanvas() {
            const width = parseInt(document.getElementById('canvasWidth').value) || 1280;
            const height = parseInt(document.getElementById('canvasHeight').value) || 800;
            let heading = document.getElementById('heading').value;
            const description = document.getElementById('description').value;
            const features = document.getElementById('features').value;
            const bgColor = document.getElementById('bgColor').value;
            const textColor = document.getElementById('textColor').value;
            const accentColor = document.getElementById('accentColor').value;
            const showHeading = document.getElementById('showHeading').checked;
            const showFeatures = document.getElementById('showFeatures').checked;
            const showChecks = document.getElementById('showChecks').checked;
            const uppercaseHeading = document.getElementById('uppercaseHeading').checked;
            const imageBorderRadius = parseInt(document.getElementById('imageBorderRadius').value) || 8;
            
            // Apply uppercase if enabled
            if (uppercaseHeading) {
                heading = heading.toUpperCase();
            }

            // Update preview info
            document.getElementById('previewInfo').textContent = `${width} × ${height}`;

            // Set canvas size
            canvas.width = width;
            canvas.height = height;

            // Use integer coordinates for better performance
            const padding = Math.round(Math.max(25, Math.min(width, height) * 0.1));
            
            // Calculate column dimensions
            const totalWidth = width - (padding * 2);
            const columnGap = padding;
            const leftColumnWidth = uploadedImage 
                ? Math.round((totalWidth - columnGap) / 2)
                : totalWidth;
            const rightColumnWidth = uploadedImage 
                ? Math.round((totalWidth - columnGap) / 2)
                : 0;

            // Clear and set background
            if (backgroundStyle !== 'solid' && currentGradient) {
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, currentGradient[0]);
                gradient.addColorStop(1, currentGradient[1]);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = bgColor;
            }
            ctx.fillRect(0, 0, width, height);
            
            // Use Inter font
            const fontFamily = '"Inter", -apple-system, BlinkMacSystemFont, system-ui, "Segoe UI", Roboto, sans-serif';
            
            // Smart font scaling with performance optimization
            const cachedScale = calculateOptimalFontScale(
                width, height, leftColumnWidth, padding,
                heading, description, features,
                showHeading, showFeatures, showChecks,
                uppercaseHeading, fontFamily
            );
            
            // Render text content
            renderTextContent(
                ctx, cachedScale, leftColumnWidth, padding,
                heading, description, features,
                showHeading, showFeatures, showChecks,
                textColor, accentColor, fontFamily,
                width, height
            );

            // Draw uploaded image if exists
            if (uploadedImage) {
                renderImage(
                    ctx, uploadedImage, padding, leftColumnWidth,
                    columnGap, rightColumnWidth, height, imageBorderRadius
                );
            }
        }

        // Calculate optimal font scale for text fitting
        function calculateOptimalFontScale(width, height, columnWidth, padding, heading, description, features, showHeading, showFeatures, showChecks, uppercaseHeading, fontFamily) {
            let minScale = 0.5;
            let maxScale = 2.0;
            let bestScale = 1.0;
            let attempts = 0;
            
            // Create temporary canvas for measurements
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            while (attempts < 15 && (maxScale - minScale) > 0.05) {
                const testScale = (minScale + maxScale) / 2;
                
                const canvasArea = width * height;
                const referenceArea = 1280 * 800;
                const areaRatio = Math.sqrt(canvasArea / referenceArea);
                
                const targetBaseSize = Math.min(width / 50, height / 35);
                const baseFontSize = Math.round(Math.max(10, targetBaseSize * areaRatio) * testScale);
                
                const headingSize = Math.round(baseFontSize * 2.5);
                const textSize = Math.round(baseFontSize);
                const lineHeightHeading = 1.1;
                const lineHeightText = 1.35;

                let measureHeight = 0;
                tempCtx.textBaseline = 'top';
                
                if (showHeading && heading) {
                    tempCtx.font = `700 ${headingSize}px ${fontFamily}`;
                    const headingLines = wrapText(tempCtx, heading, columnWidth);
                    measureHeight += headingLines.length * headingSize * lineHeightHeading;
                    measureHeight += padding * 0.25;
                }

                tempCtx.font = `500 ${textSize}px ${fontFamily}`;
                const descLines = wrapText(tempCtx, description, columnWidth);
                measureHeight += descLines.length * textSize * lineHeightText;
                
                if (showFeatures && features) {
                    measureHeight += padding * 0.25;
                    const featureLines = features.split('\n').filter(f => f.trim());
                    tempCtx.font = `600 ${textSize}px ${fontFamily}`;
                    const checkWidth = showChecks ? tempCtx.measureText('✓ ').width : 0;
                    
                    featureLines.forEach(feature => {
                        const wrappedLines = wrapText(tempCtx, feature.trim(), columnWidth - checkWidth);
                        measureHeight += wrappedLines.length * textSize * lineHeightText;
                    });
                }

                const availableHeight = height - (padding * 2);
                if (measureHeight <= availableHeight) {
                    bestScale = testScale;
                    minScale = testScale;
                } else {
                    maxScale = testScale;
                }
                attempts++;
            }
            
            return bestScale;
        }

        // Render text content with optimized drawing
        function renderTextContent(ctx, scale, columnWidth, padding, heading, description, features, showHeading, showFeatures, showChecks, textColor, accentColor, fontFamily, width, height) {
            const canvasArea = width * height;
            const referenceArea = 1280 * 800;
            const areaRatio = Math.sqrt(canvasArea / referenceArea);
            
            const finalBaseFontSize = Math.round(Math.max(10, Math.min(width / 50, height / 35) * areaRatio) * scale);
            const headingSize = Math.round(finalBaseFontSize * 2.5);
            const textSize = Math.round(finalBaseFontSize);
            const lineHeightHeading = 1.1;
            const lineHeightText = 1.35;
            
            ctx.textBaseline = 'top';
            
            let headingLines = [];
            if (showHeading && heading) {
                ctx.font = `700 ${headingSize}px ${fontFamily}`;
                headingLines = wrapText(ctx, heading, columnWidth);
            }
            
            ctx.font = `500 ${textSize}px ${fontFamily}`;
            const descLines = wrapText(ctx, description, columnWidth);
            
            let featureLines = [];
            if (showFeatures && features) {
                featureLines = features.split('\n').filter(f => f.trim());
            }
            
            // Calculate total height for vertical centering
            let totalHeight = 0;
            if (showHeading && heading) {
                totalHeight += headingLines.length * headingSize * lineHeightHeading;
                totalHeight += padding * 0.25;
            }
            totalHeight += descLines.length * textSize * lineHeightText;
            
            if (showFeatures && features && featureLines.length > 0) {
                totalHeight += padding * 0.25;
                ctx.font = `600 ${textSize}px ${fontFamily}`;
                const checkWidth = showChecks ? ctx.measureText('✓ ').width : 0;
                featureLines.forEach(feature => {
                    const wrappedLines = wrapText(ctx, feature.trim(), columnWidth - checkWidth);
                    totalHeight += wrappedLines.length * textSize * lineHeightText;
                });
            }
            
            const availableHeight = height - (padding * 2);
            let yPosition = Math.round(padding + Math.max(0, (availableHeight - totalHeight) / 2));
            
            // Draw heading
            if (showHeading && heading) {
                ctx.font = `700 ${headingSize}px ${fontFamily}`;
                ctx.fillStyle = textColor;
                headingLines.forEach(line => {
                    ctx.fillText(line, padding, yPosition);
                    yPosition += headingSize * lineHeightHeading;
                });
                yPosition += padding * 0.25;
            }
            
            // Draw description
            ctx.font = `500 ${textSize}px ${fontFamily}`;
            ctx.fillStyle = textColor;
            descLines.forEach(line => {
                ctx.fillText(line, padding, yPosition);
                yPosition += textSize * lineHeightText;
            });
            
            // Draw features
            if (showFeatures && features && featureLines.length > 0) {
                yPosition += padding * 0.25;
                
                ctx.font = `600 ${textSize}px ${fontFamily}`;
                featureLines.forEach(feature => {
                    if (showChecks) {
                        // Draw checkmark icon instead of emoji
                        ctx.fillStyle = accentColor;
                        ctx.save();
                        ctx.translate(padding, yPosition);
                        drawCheckIcon(ctx, textSize * 0.8);
                        ctx.restore();
                        
                        ctx.fillStyle = textColor;
                        const checkWidth = textSize + 8;
                        const wrappedFeature = wrapText(ctx, feature.trim(), columnWidth - checkWidth);
                        wrappedFeature.forEach((line, index) => {
                            ctx.fillText(line, padding + checkWidth, yPosition + (index * textSize * lineHeightText));
                        });
                        yPosition += wrappedFeature.length * textSize * lineHeightText;
                    } else {
                        ctx.fillStyle = textColor;
                        const wrappedFeature = wrapText(ctx, feature.trim(), columnWidth);
                        wrappedFeature.forEach((line, index) => {
                            ctx.fillText(line, padding, yPosition + (index * textSize * lineHeightText));
                        });
                        yPosition += wrappedFeature.length * textSize * lineHeightText;
                    }
                });
            }
        }

        // Draw check icon (SVG-like path)
        function drawCheckIcon(ctx, size) {
            ctx.beginPath();
            ctx.moveTo(size * 0.2, size * 0.5);
            ctx.lineTo(size * 0.4, size * 0.7);
            ctx.lineTo(size * 0.8, size * 0.3);
            ctx.lineWidth = size * 0.15;
            ctx.strokeStyle = ctx.fillStyle;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
        }

        // Render image with optimized drawing
        function renderImage(ctx, image, padding, leftColumnWidth, columnGap, rightColumnWidth, height, borderRadius) {
            const imgX = Math.round(padding + leftColumnWidth + columnGap);
            const imgMaxWidth = rightColumnWidth;
            const imgMaxHeight = height - padding * 2;

            const scale = Math.min(imgMaxWidth / image.width, imgMaxHeight / image.height);
            const imgWidth = Math.round(image.width * scale);
            const imgHeight = Math.round(image.height * scale);

            const imgY = Math.round((height - imgHeight) / 2);
            const imgXCentered = Math.round(imgX + (imgMaxWidth - imgWidth) / 2);

            // Draw shadow
            ctx.shadowColor = 'rgba(0, 0, 0, 0.1)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 10;

            // Draw image with rounded corners
            ctx.save();
            ctx.beginPath();
            if (ctx.roundRect) {
                ctx.roundRect(imgXCentered, imgY, imgWidth, imgHeight, borderRadius);
            } else {
                // Fallback for browsers without roundRect
                ctx.moveTo(imgXCentered + borderRadius, imgY);
                ctx.lineTo(imgXCentered + imgWidth - borderRadius, imgY);
                ctx.quadraticCurveTo(imgXCentered + imgWidth, imgY, imgXCentered + imgWidth, imgY + borderRadius);
                ctx.lineTo(imgXCentered + imgWidth, imgY + imgHeight - borderRadius);
                ctx.quadraticCurveTo(imgXCentered + imgWidth, imgY + imgHeight, imgXCentered + imgWidth - borderRadius, imgY + imgHeight);
                ctx.lineTo(imgXCentered + borderRadius, imgY + imgHeight);
                ctx.quadraticCurveTo(imgXCentered, imgY + imgHeight, imgXCentered, imgY + imgHeight - borderRadius);
                ctx.lineTo(imgXCentered, imgY + borderRadius);
                ctx.quadraticCurveTo(imgXCentered, imgY, imgXCentered + borderRadius, imgY);
            }
            ctx.clip();
            ctx.drawImage(image, imgXCentered, imgY, imgWidth, imgHeight);
            ctx.restore();

            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        // Text wrapping function
        function wrapText(context, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = context.measureText(currentLine + ' ' + word).width;
                if (width < maxWidth) {
                    currentLine += ' ' + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Download image with format options
        function downloadImage() {
            const format = document.getElementById('exportFormat').value;
            const scale = parseFloat(document.getElementById('exportScale').value);
            const width = parseInt(document.getElementById('canvasWidth').value);
            const height = parseInt(document.getElementById('canvasHeight').value);
            
            // Create scaled canvas if needed
            if (scale !== 1) {
                const scaledCanvas = document.createElement('canvas');
                scaledCanvas.width = width * scale;
                scaledCanvas.height = height * scale;
                const scaledCtx = scaledCanvas.getContext('2d');
                scaledCtx.scale(scale, scale);
                
                // Redraw on scaled canvas
                const tempWidth = document.getElementById('canvasWidth').value;
                const tempHeight = document.getElementById('canvasHeight').value;
                document.getElementById('canvasWidth').value = scaledCanvas.width;
                document.getElementById('canvasHeight').value = scaledCanvas.height;
                drawCanvas();
                document.getElementById('canvasWidth').value = tempWidth;
                document.getElementById('canvasHeight').value = tempHeight;
                
                downloadCanvasAsImage(canvas, format, width, height, scale);
            } else {
                downloadCanvasAsImage(canvas, format, width, height, scale);
            }
            
            showToast('Image downloaded successfully!');
        }

        // Helper function to download canvas
        function downloadCanvasAsImage(canvas, format, width, height, scale) {
            const link = document.createElement('a');
            const scaleSuffix = scale !== 1 ? `@${scale}x` : '';
            link.download = `thumbnail-${width}x${height}${scaleSuffix}.${format}`;
            
            if (format === 'jpg') {
                const quality = parseFloat(document.getElementById('jpgQualitySlider').value);
                link.href = canvas.toDataURL('image/jpeg', quality);
            } else if (format === 'webp') {
                link.href = canvas.toDataURL('image/webp', 0.9);
            } else {
                link.href = canvas.toDataURL('image/png');
            }
            
            link.click();
        }

        // Batch export function
        function batchExport() {
            const commonPresets = ['youtube', 'twitter', 'facebook', 'linkedin'];
            commonPresets.forEach((preset, index) => {
                setTimeout(() => {
                    const size = presets[preset];
                    document.getElementById('canvasWidth').value = size.width;
                    document.getElementById('canvasHeight').value = size.height;
                    drawCanvas();
                    
                    const link = document.createElement('a');
                    link.download = `thumbnail-${preset}-${size.width}x${size.height}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }, index * 500);
            });
            
            showToast('Batch export started!');
        }

        // Copy to clipboard function
        async function copyToClipboard() {
            try {
                canvas.toBlob(async (blob) => {
                    const item = new ClipboardItem({ 'image/png': blob });
                    await navigator.clipboard.write([item]);
                    showToast('Image copied to clipboard!');
                });
            } catch (err) {
                console.error('Failed to copy image:', err);
                showToast('Failed to copy image', 'error');
            }
        }

        // Save template to localStorage
        function saveCurrentTemplate() {
            const templateName = prompt('Enter a name for this template:');
            if (templateName) {
                const templates = JSON.parse(localStorage.getItem('savedTemplates') || '{}');
                templates[templateName] = {
                    bgColor: document.getElementById('bgColor').value,
                    textColor: document.getElementById('textColor').value,
                    accentColor: document.getElementById('accentColor').value,
                    heading: document.getElementById('heading').value,
                    description: document.getElementById('description').value,
                    features: document.getElementById('features').value,
                    showHeading: document.getElementById('showHeading').checked,
                    showFeatures: document.getElementById('showFeatures').checked,
                    showChecks: document.getElementById('showChecks').checked,
                    uppercaseHeading: document.getElementById('uppercaseHeading').checked,
                    backgroundStyle: backgroundStyle,
                    currentGradient: currentGradient
                };
                localStorage.setItem('savedTemplates', JSON.stringify(templates));
                loadSavedTemplates();
                showToast('Template saved successfully!');
            }
        }

        // Load saved templates
        function loadSavedTemplates() {
            const templates = JSON.parse(localStorage.getItem('savedTemplates') || '{}');
            const container = document.getElementById('savedTemplates');
            
            if (Object.keys(templates).length > 0) {
                container.innerHTML = '';
                Object.entries(templates).forEach(([name, template]) => {
                    const templateCard = document.createElement('div');
                    templateCard.className = 'template-card';
                    templateCard.style.marginBottom = '10px';
                    templateCard.innerHTML = `
                        <div class="template-preview" style="background: ${template.currentGradient ? `linear-gradient(135deg, ${template.currentGradient[0]}, ${template.currentGradient[1]})` : template.bgColor};"></div>
                        <div class="template-name">${name}</div>
                    `;
                    templateCard.onclick = () => applySavedTemplate(template);
                    container.appendChild(templateCard);
                });
            }
        }

        // Apply saved template
        function applySavedTemplate(template) {
            Object.entries(template).forEach(([key, value]) => {
                if (key === 'backgroundStyle') {
                    backgroundStyle = value;
                } else if (key === 'currentGradient') {
                    currentGradient = value;
                } else {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value;
                        } else {
                            element.value = value;
                        }
                    }
                }
            });
            updateColorPreviews();
            saveToHistory();
            drawCanvas();
            showToast('Template applied!');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'success-toast';
            if (type === 'error') {
                toast.style.background = 'var(--error)';
            }
            toast.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 20 20" fill="white">
                    <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                </svg>
                ${message}
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Toggle shortcuts modal
        function toggleShortcuts() {
            const modal = document.getElementById('shortcutsModal');
            modal.classList.toggle('active');
        }

        // Handle image file
        function handleImageFile(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        uploadedImage = img;
                        document.getElementById('fileUploadContainer').classList.add('has-file');
                        document.getElementById('uploadLabel').textContent = file.name;
                        document.getElementById('imageControls').style.display = 'block';
                        
                        // Update upload icon
                        document.getElementById('uploadDefault').style.opacity = '0';
                        document.getElementById('uploadSuccess').style.opacity = '1';
                        
                        saveToHistory();
                        drawCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
            const ctrlKey = isMac ? e.metaKey : e.ctrlKey;
            
            if (ctrlKey && e.key === 'd') {
                e.preventDefault();
                downloadImage();
            } else if (ctrlKey && e.key === 's') {
                e.preventDefault();
                saveCurrentTemplate();
            } else if (ctrlKey && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                undo();
            } else if (ctrlKey && e.shiftKey && e.key === 'z') {
                e.preventDefault();
                redo();
            } else if (ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetToDefaults();
            } else if (ctrlKey && e.key === 'c') {
                e.preventDefault();
                copyToClipboard();
            } else if (e.key === ' ' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                togglePreview();
            }
        });

        // Reset to defaults
        function resetToDefaults() {
            document.getElementById('canvasWidth').value = 1280;
            document.getElementById('canvasHeight').value = 800;
            document.getElementById('heading').value = 'Your Amazing SaaS Product';
            document.getElementById('description').value = 'The complete solution for modern teams. Streamline your workflow and boost productivity with our powerful features.';
            document.getElementById('features').value = 'Real-time collaboration\nAdvanced analytics dashboard\nSeamless integrations\nEnterprise-grade security';
            document.getElementById('bgColor').value = '#ffffff';
            document.getElementById('textColor').value = '#111827';
            document.getElementById('accentColor').value = '#3b82f6';
            document.getElementById('showHeading').checked = true;
            document.getElementById('showFeatures').checked = true;
            document.getElementById('showChecks').checked = true;
            document.getElementById('uppercaseHeading').checked = false;
            backgroundStyle = 'solid';
            currentGradient = null;
            updateColorPreviews();
            saveToHistory();
            drawCanvas();
            showToast('Reset to defaults');
        }

        // Toggle preview (placeholder for future fullscreen preview)
        function togglePreview() {
            // Future implementation for fullscreen preview
            console.log('Preview toggle');
        }

        // Event listeners
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            handleImageFile(file);
        });

        // Drag and drop event handlers
        const uploadLabel = document.getElementById('fileUploadContainer');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, function() {
                uploadLabel.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, function() {
                uploadLabel.classList.remove('drag-over');
            }, false);
        });

        uploadLabel.addEventListener('drop', function(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        }, false);

        // Add event listeners to all inputs with debouncing
        ['canvasWidth', 'canvasHeight', 'heading', 'description', 'features', 'bgColor', 'textColor', 'accentColor'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', debouncedRender);
            }
        });

        // Checkboxes don't need debouncing
        ['showHeading', 'showFeatures', 'showChecks', 'uppercaseHeading'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', () => {
                    saveToHistory();
                    drawCanvas();
                });
            }
        });

        // Range sliders
        document.getElementById('imageBorderRadius').addEventListener('input', function() {
            document.getElementById('borderRadiusValue').textContent = this.value + 'px';
            debouncedRender();
        });

        document.getElementById('jpgQualitySlider').addEventListener('input', function() {
            document.getElementById('jpgQualityValue').textContent = Math.round(this.value * 100) + '%';
        });

        // Export format change
        document.getElementById('exportFormat').addEventListener('change', function() {
            document.getElementById('jpgQuality').style.display = 
                this.value === 'jpg' ? 'block' : 'none';
        });

        // Color input change handlers
        ['bgColor', 'textColor', 'accentColor'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                // If user manually changes background color, switch to solid mode
                if (id === 'bgColor') {
                    backgroundStyle = 'solid';
                    currentGradient = null;
                    // Remove active state from all gradient presets
                    document.querySelectorAll('.gradient-preset').forEach(preset => preset.classList.remove('active'));
                }
                updateColorPreviews();
                debouncedRender();
            });
        });

        // Initialize
        window.addEventListener('load', function() {
            loadTheme();
            initOffscreenCanvas();
            updateColorPreviews();
            loadSavedTemplates();
            saveToHistory();
            drawCanvas();
        });

        // Performance monitoring (optional)
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.name === 'first-contentful-paint') {
                        console.log('FCP:', entry.startTime);
                    }
                }
            });
            observer.observe({ entryTypes: ['paint'] });
        }
    </script>
</body>
</html>